<main>
  <app-header></app-header>
  <section class="chat-container" aria-label="Chat entre usuário e assistente virtual">
    <div #messagesContainer class="messages" role="log" aria-live="polite">
      <article *ngFor="let message of messages"
        [ngClass]="{'user-message': message.role === 'user', 'bot-message': message.role === 'bot'}">
        <div class="avatar">
          <i class="fas fa-user" *ngIf="message.role === 'user'"></i>
          <i class="fas fa-home" *ngIf="message.role === 'bot'"></i>
        </div>
        <div class="mt-4">
          <p class="message-bubble">
            {{ message.text }}
          </p>
          <div class="message-content" *ngIf="message.content as content">

            <div class="content-images">
              <img *ngFor="let img of content.images" width="200px" height="150px" [src]="img" alt="">
            </div>

            <h3 class="content-title">{{content.title}} </h3>
            <p class="content-price">{{content.price | currency: content.currency}}</p>

            <p class="content-location">
              <i class="fas fa-map-marker-alt"></i>
              {{content.location}}
              <i class="fas fa-bed"></i>
              {{content.beds}}
            </p>

            <p class="content-description">
              {{content.description}}
            </p>

            <div class="content-variaties">
              <div class="item" *ngFor="let item of content.varieties">
                <p>{{item}}</p>
              </div>
            </div>
          </div>
        </div>
      </article>
    </div>

    <footer class="input-container">
      <i class="fas fa-paperclip" *ngIf="!isRecording" (click)="triggerFileInput()"></i>
      <input #fileInput type="file" style="display: none" (change)="handleFile($event)" />

      <label for="chat-input" class="visually-hidden" *ngIf="!isRecording">Digite sua mensagem</label>
      <input *ngIf="!isRecording" id="chat-input" type="text" [(ngModel)]="newMessage" (keydown.enter)="sendMessage()"
        placeholder="Digite sua mensagem..." autocomplete="off" aria-label="Campo de entrada de mensagem" />

      <!-- Botão de gravação -->
      <i class="fas fa-record-vinyl" [class.recording]="isRecording" [class.audio-ready]="audioUrl"
        (click)="toggleRecording()" aria-label="Gravar áudio"></i>

      <!-- Tempo de gravação -->
      <span *ngIf="isRecording">{{ recordingTime }}</span>

      <!-- Visualizador de áudio -->
      <div class="audio-visualizer-container" *ngIf="isRecording">
        <canvas #canvas></canvas>
      </div>

      <button type="button" (click)="toggleSendMessage()" aria-label="Enviar mensagem">
        Enviar
      </button>
    </footer>


  </section>
</main>